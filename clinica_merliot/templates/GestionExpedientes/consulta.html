{% extends "base.html" %}

{% load static from staticfiles %}
{% load crispy_forms_tags %}

{% block javascript %}
<script src="{% static 'js/plugins.js'%}"></script>
<script src="{% static 'js/jquery-ui-1.8.17.custom.min.js'%}"></script>
<script src="{% static 'js/jquery.tmpl.js'%}"></script>
<script src="{% static 'js/knockout-3.3.0.js'%}"></script>
<script src="{% static 'js/jquery.svg.min.js'%}"></script>
<script src="{% static 'js/jquery.svggraph.min.js'%}"></script>
<script src="{% static 'js/odontograma.js'%}"></script>
<script>
  // aligns the submit button
  $('.normalized-btn').addClass(' pull-right')
</script>

<script>
    window.onunload = refreshParent;
    function refreshParent() {
        window.opener.location.reload();
    }
</script>
{% endblock %}

{% block navbar %}
<ul>
  <li><a href="/">Inicio</a></li>
  <li class="active" ><a href="/GestionExpedientes/">Expedientes</a></li>
  <li><a href="{% url 'gestionExp:listarCita' %}">Agenda Citas</a></li>
  <li><a href="#">Inventario</a></li>
  <li><a href="/auth/settings/">Modificar Perfil</a></li>
  <li><a href="/auth/logout/">Salir</a></li>
  <img  align="middle" width="75" height="75" src = "{% if user.avatar %}{{ user.avatar.url}} {% endif %}">
</ul>
{% endblock %}

{% block content %}
<div class="tratamiento">
  <div class="container center">
    <div class="about-grids">
        {% if messages %}
        {% for message in messages %}
        {% if message.tags == 'success' %}
        <p style="color: green"><u>{{ message }}</u></p>
        {% else %}
        <p style="color: red"><u>{{ message }}</u> </p>
        {% endif %}
        {% endfor %}
        <p></p>
        {% endif %}
        <div class="contact-form" align="center">
            <h1>CONSULTA</h1>
            <h2>{{expediente}}</h2>
            <table>
                <tr><td><br></td></tr>
                <tr><td><br></td></tr>
                <tr>
                  <div class="tratamiento">
                    <div class="container center">
                      <div class="about-grids">
                        <div class="contact-form">
                        <div class="col-md-14 about-left">
                  <h2 class="page-header">Odontograma</h2>

                  <div class="form-inline">

                    <label for="tratamiento" class="control-label lead">1) Seleccione Tratamiento:</label>
                    <select name="tratamiento" id="tratamientos" class="form-control form-inline" data-bind="value: tratamientoSeleccionado,">

                      <option>Seleccione un Tratamiento...</option>
                      {% for tratamiento in tratamientos %}
                      <option value="{{ tratamiento.id }}">{{ tratamiento }}</option>
                      {% endfor %}

                    </select>

                  </div>

                  <form method="post">{% csrf_token %}

                    {{ formset.management_form }}

                    <p class="lead">2) Seleccione Una Pieza:</p>

                    <div id="odontograma"></div>

                    <div id="tooth-images">
                      <!--top -->
                      <!-- left-side -->
                      <img src="{% static 'img/piezas/18.jpg' %}" alt="18" width="28">
                      <img src="{% static 'img/piezas/17.jpg' %}" alt="17" width="28">
                      <img src="{% static 'img/piezas/16.jpg' %}" alt="16" width="28">
                      <img src="{% static 'img/piezas/15.jpg' %}" alt="15" width="22">
                      <img src="{% static 'img/piezas/14.jpg' %}" alt="14" width="22">
                      <img src="{% static 'img/piezas/13.jpg' %}" alt="13" width="22">
                      <img src="{% static 'img/piezas/12.jpg' %}" alt="12" width="24">
                      <img src="{% static 'img/piezas/11.jpg' %}" alt="11" width="28">
                      <!-- right-side -->
                      <img src="{% static 'img/piezas/21.jpg' %}" alt="21" width="28">
                      <img src="{% static 'img/piezas/22.jpg' %}" alt="22" width="24">
                      <img src="{% static 'img/piezas/23.jpg' %}" alt="23" width="22">
                      <img src="{% static 'img/piezas/24.jpg' %}" alt="24" width="22">
                      <img src="{% static 'img/piezas/25.jpg' %}" alt="25" width="22">
                      <img src="{% static 'img/piezas/26.jpg' %}" alt="26" width="28">
                      <img src="{% static 'img/piezas/27.jpg' %}" alt="27" width="28">
                      <img src="{% static 'img/piezas/28.jpg' %}" alt="28" width="28">
                      <br>
                      <!-- bottom -->
                      <div class="bottom">
                        <!-- left-side -->
                        <img src="{% static 'img/piezas/48.jpg' %}" alt="48" width="28">
                        <img src="{% static 'img/piezas/47.jpg' %}" alt="47" width="28">
                        <img src="{% static 'img/piezas/46.jpg' %}" alt="46" width="28">
                        <img src="{% static 'img/piezas/45.jpg' %}" alt="45" width="20">
                        <img src="{% static 'img/piezas/44.jpg' %}" alt="44" width="20">
                        <img src="{% static 'img/piezas/43.jpg' %}" alt="43" width="20">
                        <img src="{% static 'img/piezas/42.jpg' %}" alt="42" width="20">
                        <img src="{% static 'img/piezas/41.jpg' %}" alt="41" width="20">
                        <!-- right-side -->
                        <img src="{% static 'img/piezas/31.jpg' %}" alt="31" width="20">
                        <img src="{% static 'img/piezas/32.jpg' %}" alt="32" width="20">
                        <img src="{% static 'img/piezas/33.jpg' %}" alt="33" width="20">
                        <img src="{% static 'img/piezas/34.jpg' %}" alt="34" width="20">
                        <img src="{% static 'img/piezas/35.jpg' %}" alt="35" width="20">
                        <img src="{% static 'img/piezas/36.jpg' %}" alt="36" width="28">
                        <img src="{% static 'img/piezas/37.jpg' %}" alt="37" width="28">
                        <img src="{% static 'img/piezas/38.jpg' %}" alt="38" width="28">

                      </div>

                    </div>

                    <p class="lead">3) Verifique Detalles:</p>

                    <div class="clearfix" id="formsets">

                      <ul>

                      {% for procedimientoForm in formset %}

                        {% if forloop.last %}
                        <li data-bind="foreach: tratamientosAplicados">
                          <div class="form-inline" data-bind='attr: { id: form_div_id }'>

                        {% else %}
                        <li>
                          <div class="form-inline" id="form_div_{{forloop.counter0}}">
                        {% endif %}

                          {% crispy procedimientoForm %}

                          </div>
                          <a href="#" data-bind="click: $parent.quitarTratamiento" class="pull-left text-warning bin"><i class="fa fa-trash fa-lg"></i></a>
                        </li></li>

                      {% endfor %}

                      </ul><!-- end foreach -->

                    </div>

                    <h3 class="page-header">Detalle Informacion Adicional</h3>

                    {% crispy form2 %}

                  </div>

                  </div>
                  </div>

                  </div>

                  </div>
                  </div>
                </tr>
                <tr>
                    <td align="right"><b>Sexo: </b></td>
                    <td>{{expediente.paciente.sexo}}</td>
                </tr>

                <tr><td><br></td></tr>
                <tr>
                    <td align="right"><b>Edad: </b></td>
                    <td>{{edad}}</td>
                </tr>

                <tr><td><br></td></tr>
                <tr>
                    <td align="right"><b>Observaciones Expediente: </b></td>
                    <td>{{expediente.observacionExp}} </td>
                </tr>

                <tr><td><br></td></tr>
                    <div class="contact-form-row">
                        <tr>
                            <td align="right">
                                {{ form.doctor.label_tag }}
                            </td>
                            <td>
                                {{ form.doctor }}
                            </td>
                        </tr>
                        {% if form.doctor.help_text %}
                        <small style="color: grey">{{ form.doctor.help_text|safe }}</small>
                        {% endif %}
                        {% for error in form.doctor.errors %}
                        <div class="alert alert-danger">
                            <strong>{{ error|escape }}</strong>
                        </div>
                        {% endfor %}
                    </div>


                <tr><td><br></td></tr>
                <div class="contact-form-row">
                    <tr>
                        <td align="right">{{ form1.tratamientos.label_tag }}</td>
                        <td>{{ form1.tratamientos }}</td>
                    </tr>
                    {% if form1.tratamientos.help_text %}
                    <tr>
                        <td></td>
                        <td width="100px"><small style="color: grey">{{ form1.tratamientos.help_text|safe }}</small></td>
                    </tr>
                    {% endif %}
                    {% for error in form1.tratamientos.errors %}
                    <div class="alert alert-danger">
                        <strong>{{ error|escape }}</strong>
                    </div>
                    {% endfor %}
                </div>

                <tr><td><br></td></tr>
                <div class="contact-form-row">
                    <tr>
                        <td align="right">{{ form.observacionCons.label_tag }}</td>
                        <td>{{ form.observacionCons}}</td>
                    </tr>
                    {% if form1.tratamientos.help_text %}
                    <small style="color: grey">{{ form.observacionCons.help_text|safe }}</small>
                    {% endif %}
                    {% for error in form1.tratamientos.errors %}
                    <div class="alert alert-danger">
                        <strong>{{ error|escape }}</strong>
                    </div>
                    {% endfor %}
                </div>


                <tr><td><br></td></tr>
                <tr>
                    <td></td>
                    <td align="center"><h2>ODONTOGRAMA{{consulta}}</h2></td>
                </tr>

                <tr>
                  <td></td>
                  <td align="center" >{{odontograma.id}}
                    {% if consulta.paciente.odontograma != None %}
                      <a type="button" class="more-btn" onclick="return popup('{% url 'odontograma:odontograma_detail' consulta.paciente.odontograma.id %}')">Ver Odontograma</a>
                    {% else %}
                      <a type="button" class="more-btn" onclick="return popup('{% url 'odontograma:odontograma' consulta.id %}')">Crear Odontograma</a>
                    {% endif %}
                  </td>
                </tr>
                <script>
                function popup(page) {
                  var w = window.open(page, "popup_test", "titlebar=no, menubar=no, statusbar=no, toolbar=no");
                  w.resizeTo(1000,500);
                }
                </script></td>
                <tr>
                    <td></td>
                    <td align="center"><input value="Enviar" type="submit"></td>
                </tr>

                </form>
            </table>
        </div>
    </div>
  </div>
</div>
<br>
{% endblock %}
